{% extends "base.html" %}

{% block content %}
<section class="hero">
    <h1>UUID Decoder</h1>
    <p>Analyze and decode any UUID to understand its structure and properties</p>
</section>

<section class="uuid-decoder">
    <div class="card">
        <h2>Decode a UUID</h2>
        
        <form id="decoder-form">
            <div class="form-group">
                <label for="uuid-input">
                    Enter a UUID to decode:
                    <div class="tooltip-container">
                        <span class="info-icon">?</span>
                        <span class="tooltip-text">
                            Enter an existing UUID to get detailed information about its structure, version, and components.
                            All standard formats are supported (with or without hyphens, with or without braces).
                        </span>
                    </div>
                </label>
                <input type="text" id="uuid-input" name="uuid" placeholder="e.g.: 550e8400-e29b-41d4-a716-446655440000" required>
            </div>
            
            <button type="submit" class="btn">Decode UUID</button>
        </form>
        
        <div id="decoder-result" class="result" style="display: none;">
            <h3>Result:</h3>
            
            <div id="error-message" class="error-message" style="display: none;">
                <p>Invalid UUID. Please check the format and try again.</p>
            </div>
            
            <div id="valid-result">
                <div class="result-section">
                    <h4>General Information</h4>
                    <table class="info-table">
                        <tr>
                            <th>UUID</th>
                            <td id="uuid-formatted"></td>
                        </tr>
                        <tr>
                            <th>Type</th>
                            <td id="uuid-type"></td>
                        </tr>
                        <tr>
                            <th>Version</th>
                            <td id="uuid-version"></td>
                        </tr>
                        <tr>
                            <th>Variant</th>
                            <td id="uuid-variant"></td>
                        </tr>
                    </table>
                </div>
                
                <div class="result-section">
                    <h4>Alternative Representations</h4>
                    <table class="info-table">
                        <tr>
                            <th>Hexadecimal</th>
                            <td id="uuid-hex"></td>
                        </tr>
                        <tr>
                            <th>GUID Format</th>
                            <td id="uuid-guid"></td>
                        </tr>
                        <tr>
                            <th>Integer</th>
                            <td id="uuid-int"></td>
                        </tr>
                        <tr>
                            <th>URN</th>
                            <td id="uuid-urn"></td>
                        </tr>
                    </table>
                </div>
                
                <div class="result-section">
                    <h4>Component Details</h4>
                    <table class="info-table" id="uuid-components">
                        <tr>
                            <th>Time low</th>
                            <td id="time-low"></td>
                        </tr>
                        <tr>
                            <th>Time mid</th>
                            <td id="time-mid"></td>
                        </tr>
                        <tr>
                            <th>Time high and version</th>
                            <td id="time-high"></td>
                        </tr>
                        <tr>
                            <th>Clock sequence high & variant</th>
                            <td id="clock-seq-high"></td>
                        </tr>
                        <tr>
                            <th>Clock sequence low</th>
                            <td id="clock-seq-low"></td>
                        </tr>
                        <tr>
                            <th>Node</th>
                            <td id="node"></td>
                        </tr>
                    </table>
                </div>
                
                <div id="v1-timestamp" class="result-section" style="display: none;">
                    <h4>Timestamp Information (UUID v1)</h4>
                    <p id="timestamp-date"></p>
                    <p id="timestamp-raw"></p>
                </div>
                
                <div class="result-actions">
                    <button id="copy-decoded" class="btn-action">Copy Result</button>
                    <button id="decode-generate-qr" class="btn-action">QR Code</button>
                </div>
                
                <div id="decode-qr-result" style="display: none;">
                    <h4>QR Code:</h4>
                    <div id="decode-qr-image"></div>
                    <button id="decode-download-qr" class="btn-small">Download</button>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="uuid-info">
    <h2>About UUIDs</h2>
    <div class="info-grid">
        <div class="info-card">
            <h3>What is a UUID?</h3>
            <p>A UUID (Universally Unique Identifier) is a 128-bit identifier designed to be globally unique without centralized coordination.</p>
        </div>
        <div class="info-card">
            <h3>UUID Versions</h3>
            <p>There are different UUID versions, each generated differently: v1 (time-based), v3 (MD5 hash), v4 (random), v5 (SHA-1 hash).</p>
        </div>
        <div class="info-card">
            <h3>Structure</h3>
            <p>A standard UUID is represented by 32 hexadecimal characters, displayed in 5 groups separated by hyphens: 8-4-4-4-12.</p>
        </div>
        <div class="info-card">
            <h3>Uses</h3>
            <p>UUIDs are used in databases, software development, and object tracking to ensure uniqueness without conflicts.</p>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const decoderForm = document.getElementById('decoder-form');
    const decoderResult = document.getElementById('decoder-result');
    const errorMessage = document.getElementById('error-message');
    const validResult = document.getElementById('valid-result');
    const v1Timestamp = document.getElementById('v1-timestamp');
    
    decoderForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const uuidInput = document.getElementById('uuid-input').value.trim();
        
        fetch('/decode-uuid', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `uuid=${encodeURIComponent(uuidInput)}`
        })
        .then(response => response.json())
        .then(data => {
            decoderResult.style.display = 'block';
            
            if (!data.is_valid) {
                errorMessage.style.display = 'block';
                validResult.style.display = 'none';
                return;
            }
            
            errorMessage.style.display = 'none';
            validResult.style.display = 'block';
            
            // Fill general information
            document.getElementById('uuid-formatted').textContent = data.uuid;
            document.getElementById('uuid-type').textContent = data.type || 'Not determined';
            document.getElementById('uuid-version').textContent = data.uuid_version || 'Not available';
            document.getElementById('uuid-variant').textContent = data.uuid_variant || 'Not available';
            
            // Alternative representations
            document.getElementById('uuid-hex').textContent = data.uuid_hex;
            document.getElementById('uuid-guid').textContent = `{${data.uuid.toUpperCase()}}`;
            document.getElementById('uuid-int').textContent = data.uuid_int;
            document.getElementById('uuid-urn').textContent = `urn:uuid:${data.uuid}`;
            
            // Component details
            if (data.fields) {
                document.getElementById('time-low').textContent = data.fields.time_low.toString(16).padStart(8, '0');
                document.getElementById('time-mid').textContent = data.fields.time_mid.toString(16).padStart(4, '0');
                document.getElementById('time-high').textContent = data.fields.time_hi_version.toString(16).padStart(4, '0');
                document.getElementById('clock-seq-high').textContent = data.fields.clock_seq_hi_variant.toString(16).padStart(2, '0');
                document.getElementById('clock-seq-low').textContent = data.fields.clock_seq_low.toString(16).padStart(2, '0');
                document.getElementById('node').textContent = data.fields.node.toString(16).padStart(12, '0');
            }
            
            // Timestamp information for UUID v1
            if (data.timestamp) {
                v1Timestamp.style.display = 'block';
                const timestampDate = new Date((data.timestamp - 0x01b21dd213814000) / 10000);
                document.getElementById('timestamp-date').textContent = `Date: ${timestampDate.toLocaleString()}`;
                document.getElementById('timestamp-raw').textContent = `Raw timestamp: ${data.timestamp}`;
            } else {
                v1Timestamp.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            decoderResult.style.display = 'block';
            errorMessage.style.display = 'block';
            validResult.style.display = 'none';
        });
    });
    
    // Copy button
    document.getElementById('copy-decoded').addEventListener('click', function() {
        const uuidValue = document.getElementById('uuid-formatted').textContent;
        navigator.clipboard.writeText(uuidValue)
            .then(() => alert('UUID copied to clipboard!'))
            .catch(err => console.error('Error copying:', err));
    });
    
    // QR Code button
    document.getElementById('decode-generate-qr').addEventListener('click', function() {
        const uuidValue = document.getElementById('uuid-formatted').textContent;
        const qrResult = document.getElementById('decode-qr-result');
        const qrImage = document.getElementById('decode-qr-image');
        
        fetch('/generate-qr', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `uuid=${encodeURIComponent(uuidValue)}`
        })
        .then(response => response.blob())
        .then(blob => {
            const imgUrl = URL.createObjectURL(blob);
            qrImage.innerHTML = `<img src="${imgUrl}" alt="QR Code" style="max-width: 100%;">`;
            qrResult.style.display = 'block';
            
            // Download button
            document.getElementById('decode-download-qr').addEventListener('click', function() {
                const a = document.createElement('a');
                a.href = imgUrl;
                a.download = `qr-${uuidValue}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
        })
        .catch(error => {
            console.error('Error:', error);
            qrImage.innerHTML = '<p>Error generating QR code.</p>';
            qrResult.style.display = 'block';
        });
    });
});
</script>

<style>
.uuid-decoder .card {
    margin-bottom: 30px;
}

.info-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.info-table th, .info-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.info-table th {
    width: 40%;
    font-weight: 600;
}

.result-section {
    margin-bottom: 30px;
}

.result-section h4 {
    margin-bottom: 15px;
    padding-bottom: 5px;
    border-bottom: 2px solid #3498db;
}

.error-message {
    padding: 10px;
    background-color: #f8d7da;
    color: #721c24;
    border-radius: 5px;
    margin-bottom: 20px;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.info-card {
    background-color: var(--card-bg);
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.info-card h3 {
    margin-top: 0;
    color: var(--primary-color);
}

/* Support des thèmes sombre et clair */
body.dark-mode .error-message {
    background-color: #362a2d;
    color: #f8d7da;
}

body.dark-mode .info-table th, body.dark-mode .info-table td {
    border-bottom: 1px solid #444;
}
</style>
{% endblock %} 